<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>handleliste</title>
    <link href="@Url.Content("~/Content/Site.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/modernizr-2.0.6-development-only.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/jquery-1.6.2.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/knockout.js")" type="text/javascript"></script>
    <meta name="viewport" content="width=device-width" />

    <script type="text/javascript">

    $(document).ready(function () {

        function ItemViewModel(name) {
            var self = this;
            self.name = ko.observable(name);
        };

        function ShoppingListViewModel() {
            var self = this;
            self.items = ko.observableArray([
                //new ItemViewModel("brød"),
                //new ItemViewModel("melk")
            ]);

            self.newItemText = ko.observable();

            // Operations
            self.addNewItem = function () {
                var newItem = new ItemViewModel(this.newItemText());
                self.items.push(newItem);
                save(newItem);
                self.newItemText("");
            };

            // Load initial state from server, convert it to ItemViewModel instances, then populate self.items
            $.getJSON("/api/items", function (data) {
                var mappedItems = $.map(data, function (item) {
                    return new ItemViewModel(item.Name)
                });
                self.items(mappedItems);
            });

            // Save to server
            save = function(newItem) {
                $.ajax("/api/items", {
                    data: ko.toJSON(newItem),
                    type: "post", contentType: "application/json",
                    error: function (message) { alert(message) }
                });
            };
        };

        ko.applyBindings(new ShoppingListViewModel());
    });
    
    </script>

</head>
<body>
    <h1>handleliste:</h1>

    <table>
        <tbody data-bind="foreach: items">
            <tr>
                <td data-bind="text: name"></td>
            </tr>    
        </tbody>
    </table>

@*    <form data-bind="submit: addItem">
        <fieldset>
            <legend>Item</legend>
            <p>
                <input type="text" data-bind="value: newItemText" placeholder="ny vare" />
                <input type="submit" value="legg til" />
            </p>
        </fieldset>
    </form>*@

    <fieldset>
        <legend>Item</legend>
        <p>
            <input type="text" data-bind="value: newItemText" placeholder="ny vare" />
            <button data-bind="click: addNewItem">legg til</button>
        </p>
    </fieldset>
    
</body>
</html>
